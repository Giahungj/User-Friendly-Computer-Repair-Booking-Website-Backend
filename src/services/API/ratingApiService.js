import db from '../../models';
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
const readTechnicianRatingsApiService = async (technicianId) => {
    try {
        const ratings = await db.Rating.findAll({
            where: { technician_id: technicianId },
            attributes: ['rating_id', 'rating', 'comment', 'createdAt', 'updatedAt'],
            include: [{
                model: db.Technician, attributes: [],
                include: [{
                    model: db.User,
                    attributes: ['name', 'avatar'],
                }]
            }],
            raw: true, nest: true,
            order: [['createdAt', 'DESC']], // Sắp xếp đánh giá mới nhất trước
        });

        if (!ratings || ratings.length === 0) {
            return { EC: -1, EM: 'Không tìm thấy đánh giá', DT: [] };
        }
        return { EC: 0, EM: 'Thành công', DT: ratings };
    } catch (error) {
        console.error('Lỗi khi lấy đánh giá:', error);
        return { EC: -1, EM: 'Lỗi server', DT: {} };
    }
};
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
export default {
    readTechnicianRatingsApiService,
}