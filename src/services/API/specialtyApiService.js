import db from '../../models';
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
const getAllSpecialties = async () => {
    try {
        const specialties = await db.Specialty.findAll({
            attributes: [
                'specialty_id','name','description','image',
                [db.sequelize.fn('COUNT', db.sequelize.col('Technicians.technician_id')), 'technicianCount']
            ],
            include: [{
                model: db.Technician,
                attributes: [],            
                through: { attributes: [] }
            }],
            group: ['Specialty.specialty_id'],
            raw: true
        });
        if (specialties.length === 0) {
            return { EC: -1, EM: 'Không tìm thấy chuyên môn.', DT: [] };
        }
        return {
            EC: 0,
            EM: 'Lấy danh sách chuyên môn thành công',
            DT: specialties
        };
    } catch (error) {
        console.error('Error in getAllSpecialties:', error?.message || error);
        return {
            EC: -1,
            EM: error?.message || 'Lỗi server',
            DT: []
        };
    }
};
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
export default {
    getAllSpecialties,
}